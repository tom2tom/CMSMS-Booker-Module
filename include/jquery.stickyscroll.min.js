/*!
table sticky-scroll plugin for JQuery
Version 0.8.0
Copyright (C) 2016 Tom Phane
Licensed under the GNU Affero GPL v.3 or, at the distributor's discretion, a later version.
See http://www.gnu.org/licenses#AGPL.
*/
;(function($,window,a,b){$.fn.stickyscroll=function(z){var B="_sg_index_",v="_sg_adj_",C={fixedRowsTop:null,fixedRowsBottom:null,fixedColumnsLeft:0,fixedColumnsRight:0,scrollableRows:"auto",scrollableColumns:"auto",scrollX:0,scrollY:0,overflowY:"auto",overflowX:"auto",visibleHeight:"auto",visibleWidth:"auto",reSizable:false};function d(U){var V=U.$table[0];if(U.fixedRowsTop===null){if(V.tHead){U.fixedRowsTop=V.tHead.rows.length}else{U.fixedRowsTop=1}}if(U.fixedRowsBottom===null){if(V.tFoot){U.fixedRowsBottom=V.tFoot.rows.length}else{U.fixedRowsBottom=0}}}function j(U){if(U.columnsCount!=-1){return U.columnsCount}U.columnsCount=Math.max.apply(null,$(U.$table[0].rows).map(function(){return this.cells.length}).get());if(U.vbar){U.columnsCount--}return U.columnsCount}function n(U,W){if(typeof(U)==="number"||(/px$/.test(U))){return parseInt(U,10)}var X=$("<div></div>");X.css({visbility:"hidden",position:"absolute","line-height":0});if(/%$/.test(U)){W=W.parentNode||W;X.css("height",U)}else{X.css({"border-style":"solid","border-bottom-width":0,"border-top-width":U})}if(!W){W=a.body}W.appendChild(X[0]);var V=X[0].offsetHeight;W.removeChild(X[0]);return V}function R(W){var V,Y,ab,aa,X=false,U=null;if(W.scrollableRows=="auto"||W.autorows){if(W.$table[0].rows.length>W.fixedRowsTop+W.fixedRowsBottom){if(W.visibleHeight&&W.visibleHeight!="auto"){V=n(W.visibleHeight,W.$table[0])}else{U=W.$table.parent();V=U.height()-(W.$table.outerHeight()-W.$table.height())}aa=W.heights;ab=W.fixedRowsTop;if(ab){for(Y=0;Y<ab&&V>=0;Y++){V-=aa[Y]}aa.splice(0,ab)}ab=W.fixedRowsBottom;if(ab){for(Y=0;Y<ab&&V>=0;Y++){V-=aa[-Y-1]}aa.splice(-1,ab)}ab=aa.length;if(ab){aa.sort(function(ad,ac){return ac-ad});for(Y=0;Y<ab&&V>=0;Y++){V-=aa[Y]}}if(V<0){X=true;Y--}W.scrollableRows=Math.max(Y,0)}else{W.scrollableRows=0}W.autorows=true}if(W.scrollableColumns=="auto"||W.autocols){var Z=j(W);if(Z>W.fixedColumnsLeft+W.fixedColumnsRight){if(W.visibleWidth&&W.visibleWidth!="auto"){V=n(W.visibleWidth,W.$table[0])}else{if(U===null){U=W.$table.parent()}V=U.width()-(W.$table.outerWidth()-W.$table.width())}aa=W.widths;ab=W.fixedColumnsLeft;if(ab){for(Y=0;Y<ab&&V>=0;Y++){V-=aa[Y]-1}aa.splice(0,ab)}ab=W.fixedColumnsRight;if(ab){for(Y=0;Y<ab&&V>=0;Y++){V-=aa[-Y-1]}aa.splice(-1,ab)}ab=aa.length;if(ab){aa.sort(function(ad,ac){return ac-ad});for(Y=0;Y<ab&&V>=0;Y++){V-=aa[Y]}}if(V<0){if(X){Y-=2}}W.scrollableColumns=Math.max(Y,0)}else{W.scrollableColumns=0}W.autocols=true}}function L(U){var V=j(U)-U.fixedColumnsLeft-U.fixedColumnsRight;if(V<1){return 1}return V}function J(U){var V=j(U)-U.fixedColumnsLeft-U.fixedColumnsRight;if(V>U.scrollableColumns){return U.scrollableColumns}if(V<1){return 1}return V}function A(U){var V=j(U)-U.fixedColumnsLeft-U.fixedColumnsRight;return V>U.scrollableColumns}function w(Y){if(j(Y)<(Y.fixedColumnsLeft+Y.fixedColumnsRight)){return}if(A(Y)||Y.overflowX=="scroll"){var W=Y.$table[0],ad=W.insertRow(W.rows.length);if(Y.fixedColumnsLeft>0){var Z=$(ad.insertCell(0));Z.css({margin:0,border:0,padding:0});if(Y.fixedColumnsLeft>1){Z.attr("colspan",Y.fixedColumnsLeft)}}var ac=$(ad.insertCell(-1)),aa=J(Y);ac.attr("colspan",aa).css({"margin-left":0,"margin-right":0,"padding-left":0,"padding-right":0}).addClass("sg-h-scroll-cell");var V=ac.outerWidth();var X=$("<div></div>");X.css({"margin-left":0,"margin-right":-20000,"padding-left":0,"padding-right":0,"overflow-x":"scroll",overflow:"scroll"}).addClass("sg-h-scroll-container").width(V);var ab=$("<div></div>");ab.height(1).width((L(Y)/J(Y))*V).appendTo(X);X.appendTo(ac).on("scroll",Y,function(){if(Y.hscrollTimer===null){N(Y);Y.hscrollTimer=setTimeout(function(){Y.hscrollTimer=null},300)}});var U=Y.fixedColumnsRight+(Y.vbar?1:0);if(U>0){var Z=$(ad.insertCell(-1));Z.css({margin:0,border:0,padding:0});if(U>1){Z.attr("colspan",U)}}Y.hbar=true}}function m(U){var V=$(".sg-h-scroll-container",U.$table);return V.scrollLeft()/V.width()}function G(U){var V=$(".sg-h-scroll-container",U.$table);return $("div",V).width()-V.width()}function H(U){return L(U)-J(U)}function r(U){if(H(U)===0){return 0}return G(U)/H(U)}function D(U,V){U=Math.min(H(V),U);if(U<0){U=0}U=r(V)*U;var W=$(".sg-h-scroll-container",V.$table);if(W.scrollLeft()!=U){W.scrollLeft(U)}}function c(X,V,U,W,Y){var ae=Y.$table[0].rows;for(var ab=U;ab<W;ab++){var ad=ae[ab];for(var Z=0;Z<ad.cells.length;Z++){var ac=ad.cells[Z],aa=ac[B];if(aa==X){if(!ac.colSpan||ac.colSpan==1){if(V&&ac.style.display=="none"){ac.style.display=""}if(!V&&ac.style.display!="none"){ac.style.display="none"}}}}}}function t(W){var Z=W.$table[0],Y=W.fixedRowsTop,V=Z.rows.length-W.fixedRowsBottom-(W.hbar?1:0);for(;Y<V;Y++){if(Z.rows[Y].style.display!="none"){var X=W.fixedColumnsLeft,U=j(W)-W.fixedColumnsRight;for(;X<U;X++){if(Z.rows[Y].cells[X].style.display!="none"){return $(Z.rows[Y].cells[X]).width()}}}}return 0}function u(W){var Z=W.$table[0],Y=W.fixedRowsTop,V=Z.rows.length-W.fixedRowsBottom-(W.hbar?1:0);for(;Y<V;Y++){if(Z.rows[Y].style.display!="none"){var X=j(W)-W.fixedColumnsRight-1,U=W.fixedColumnsLeft;for(;X>=U;X--){if(Z.rows[Y].cells[X].style.display!="none"){return $(Z.rows[Y].cells[X]).width()}}}}return 0}function q(W){var Z=$(".sg-h-scroll-container",W.$table),U=Z.scrollLeft(),Y=$("div",Z),aa=Z.closest("td"),V=aa.width(),X=(L(W)/J(W))*V;Z.width(V);Y.width(X);Z.scrollLeft(U)}function N(V){if(!A(V)){return}var Z=$(".sg-h-scroll-container",V.$table),Y=Math.floor(Z.scrollLeft()/r(V)),W=m(V),X=V.fixedColumnsLeft,U=j(V)-V.fixedColumnsRight;for(;X<U;X++){var aa=(X>=V.fixedColumnsLeft+Y&&X<V.fixedColumnsLeft+Y+V.scrollableColumns);c(X,aa,0,V.$table[0].rows.length-1,V)}q(V)}function e(U){var W=U.$table[0],V=W.rows.length-U.fixedRowsTop-U.fixedRowsBottom;if(U.hbar){V--}if(V<1){return 1}return V}function x(U){var W=U.$table[0],V=W.rows.length-U.fixedRowsTop-U.fixedRowsBottom;if(V>U.scrollableRows){return U.scrollableRows}if(V<1){return 1}return V}function o(U){var W=U.$table[0],V=W.rows.length-U.fixedRowsTop-U.fixedRowsBottom;if(U.hbar){V--}return V>U.scrollableRows}function K(Y){var W=Y.$table[0];if(W.rows.length<(Y.fixedRowsTop+Y.fixedRowsBottom)){return}if(o(Y)||Y.overflowY=="scroll"){var aa=$(W.rows[0].insertCell(W.rows[0].cells.length));if(aa.prev().is("th")){aa[0].outerHTML='<th style="margin:0;border:0;padding:0;"></th>'}else{aa.css({margin:0,border:0,padding:0})}if(Y.fixedRowsTop>1){aa.attr("rowspan",Y.fixedRowsTop)}var Z=Y.fixedRowsTop+Y.startFrom,ae=$(W.rows[Z].insertCell(W.rows[Z].cells.length)),ab=x(Y);ae.attr("rowspan",ab).attr("width",1).css({"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0}).addClass("sg-v-scroll-cell");var U=ae.outerHeight();var V=$("<div></div>");V.css({"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0,"overflow-y":"scroll",overflow:"scroll"}).addClass("sg-v-scroll-container").height(U);var ad=$("<div></div>");ad.width(1).height((e(Y)/x(Y))*U).appendTo(V);V.appendTo(ae).on("scroll",Y,function(){if(Y.vscrollTimer===null){h(Y);Y.vscrollTimer=setTimeout(function(){Y.vscrollTimer=null},300)}});if(Y.fixedRowsBottom!==0){var X=W.rows[e(Y)+Y.fixedRowsTop];var ac=$(X.insertCell(X.cells.length));ac.css({margin:0,border:0,padding:0});if(Y.fixedRowsBottom>1){ac.attr("rowspan",Y.fixedRowsBottom)}}Y.vbar=true}}function S(U){var V=$(".sg-v-scroll-container",U.$table);return V.scrollTop()/V.height()}function s(U){var V=$(".sg-v-scroll-container",U.$table);return $("div",V).height()-V.height()}function p(U){return e(U)-x(U)}function Q(U){if(p(U)===0){return 0}return s(U)/p(U)}function f(U,V){U=Math.min(p(V),U);if(U<0){U=0}var W=Q(V);U=W*U;var X=$(".sg-v-scroll-container",V.$table);if(X.scrollTop()!=U){X.scrollTop(U+W/2)}}function P(Z,V){var Y=$(".sg-v-scroll-cell",V.$table).closest("tr")[0],W=V.$table[0].rows[V.fixedRowsTop+V.startFrom],ab=$(".sg-v-scroll-container",V.$table),U=$("div",ab);if(Y!=W){var aa=$(W.insertCell(W.cells.length));aa.attr("rowspan",x(V)).addClass("sg-v-scroll-cell").attr("width","1px");var X=$(".sg-v-scroll-container",$(Y));X.height(0).appendTo(aa);Y.deleteCell(Y.cells.length-1);ab.height(aa.height());U.height((e(V)/x(V))*aa.height());ab.scrollTop(Z*ab.height())}}function i(W){var Y=$(".sg-v-scroll-container",W.$table),U=Y.scrollTop(),V=$("div",Y),aa=Y.closest("td"),X=aa.height(),Z=(e(W)/x(W))*X;Y.height(X);V.height(Z);Y.scrollTop(U)}function F(V){var X=V.$table[0],W=V.fixedRowsTop,U=X.rows.length-V.fixedRowsBottom-(V.hbar?1:0);for(;W<U;W++){if(X.rows[W].style.display!="none"){return $(X.rows[W]).height()}}return 0}function I(U){var W=U.$table[0],V=W.rows.length-U.fixedRowsBottom-(U.hbar?1:0)-1;lasti=U.fixedRowsTop;for(;V>=lasti;V--){if(W.rows[V].style.display!="none"){return $(W.rows[V]).height()}}return 0}function h(V){if(!o(V)){return}var X=$(".sg-v-scroll-container",V.$table);var Z=Math.floor(X.scrollTop()/Q(V));var Y=S(V);var aa=V.$table[0],W=V.fixedRowsTop,U=aa.rows.length-V.fixedRowsBottom-(V.hbar?1:0);for(;W<U;W++){if(W>=V.fixedRowsTop+Z&&W<V.fixedRowsTop+Z+V.scrollableRows){$(aa.rows[W]).show()}else{$(aa.rows[W]).hide()}}if(V.startFrom!=Z){V.startFrom=Z;P(Y,V)}}function O(X){var U=false,aa=false,W=X.originalEvent;if(W.wheelDelta){if(W.wheelDelta>=120){U=true}else{if(W.wheelDelta<=-120){aa=true}}}if(W.detail){if(W.detail==-3){U=true}else{if(W.detail==3){aa=true}}}var V=X.data,Y=$(".sg-v-scroll-container",V.$table),Z=0;if(U){Z=Q(V)+1}if(aa){Z=-Q(V)-1}if(Z!==0){Y.scrollTop(Y.scrollTop()-Z)}X.preventDefault()}function l(V){if(V.originalEvent.touches&&V.originalEvent.touches.length==1){var U=V.data,W=V.originalEvent.touches[0]||V.originalEvent.changedTouches[0];U.currentTouch={X:W.pageX,Y:W.pageY};V.preventDefault();V.stopPropagation()}}function T(V){var ac=V.data;if(V.originalEvent.touches&&V.originalEvent.touches.length==1&&ac.currentTouch!==null){var Z=V.originalEvent.touches[0]||V.originalEvent.changedTouches[0];var ad={X:Z.pageX,Y:Z.pageY},Y=ac.currentTouch.X-ad.X,X=ac.currentTouch.Y-ad.Y;var W=$(".sg-v-scroll-container",ac.$table);if(X>0){var ab=F(ac);if(ab!==0&&X>ab){W.scrollTop(W.scrollTop()+(Q(ac)+1));ac.currentTouch.Y-=ab;h(ac)}}else{var ab=I(ac);if(ab!==0&&X<-1*ab){W.scrollTop(W.scrollTop()-(Q(ac)+1));ac.currentTouch.Y+=ab;h(ac)}}var aa=$(".sg-h-scroll-container",ac.$table);if(Y>0){var U=t(ac);if(U!==0&&Y>U){aa.scrollLeft(aa.scrollLeft()+(r(ac)+1));ac.currentTouch.X-=ab}}else{var U=u(ac);if(U!==0&&Y<-1*U){aa.scrollLeft(aa.scrollLeft()-(r(ac)+1));ac.currentTouch.X+=U}}V.preventDefault();V.stopPropagation()}}function M(V){var U=V.data;U.currentTouch=null}function y(W){var U=W.data;if(U.resizeTimer===null){E(U);R(U);if(U.scrollableRows=="auto"||U.autorows){if(!U.vbar){K(U)}h(U);i(U);if(!U.autorows){U.vbar=false;U.scrollableRows=="auto"}}if(U.scrollableColumns=="auto"||U.autocols){if(!U.hbar){w(U)}N(U);q(U);if(!U.autocols){var V=U.$table[0].rows.length-1;U.$table[0].deleteRow(V);U.hbar=false;U.scrollableRows=="auto"}}U.resizeTimer=setTimeout(function(){U.resizeTimer=null},333)}}function g(ab){var aj=ab.$table[0].rows,ak=aj.length;for(var af=0;af<ak;af++){var ai=aj[af],ac=ai.cells.length,aa=ai[v];if(!aa){aa=[]}for(var ad=0;ad<ac;ad++){var ah=ad-1;if(ad>0){var X=$(ai.cells[ad-1]);ah=X[0][B];if(X.attr("colspan")){ah+=k(X)-1}}var ae=$(ai.cells[ad]),U=ah+1;for(var Z=0;Z<aa.length;Z++){if(aa[Z].index<=U){U+=aa[Z].adjustment;aa[Z].adjustment=0}}ae[0][B]=U;var ag=ae.attr("rowspan");if(ag>1){for(var W=af+1;W<af+ag&&W<ak;W++){var Y=aj[W],V=Y[v];if(!V){V=[]}V.push({index:U,adjustment:k(ae)});Y[v]=V}}}}}function E(V){if(!V.heights||V.reSizable){V.heights=[];V.widths=[];var ae=V.$table[0].rows.length-1;if(V.hbar){ae--}for(var ac=0;ac<ae;ac++){var X=0,Z=0,ad=V.$table[0].rows[ac],Y=ad.cells.length;if(V.vbar&&ac==(V.fixedRowsTop+V.startFrom)){Y--}for(var aa=0;aa<Y;aa++){var ab=$(ad.cells[aa]),U=ab.outerHeight(),W=ab.outerWidth();if(U>X){X=U}if(W>Z){Z=W}V.widths[aa]=Z-1}V.heights[ac]=X-1}}}function k(U){if(U.data("scroll-span")){return U.data("scroll-span")}if(U.attr("colspan")){return U.attr("colspan")*1}return 1}return this.each(function(){var V=$(this);if(!V.is("table")){return this}if($.data(this,"_sg_config")){return this}var U=$.extend({},C,{$table:V,heights:null,widths:null,columnsCount:-1,currentTouch:null,startFrom:0,hbar:false,vbar:false,hscrollTimer:null,vscrollTimer:null,resizeTimer:null},z||{});d(U);E(U);R(U);g(U);K(U);i(U);w(U);q(U);if(U.scrollY){f(U.scrollY,U)}h(U);if(U.scrollX){D(U.scrollX,U)}N(U);V.on("mousewheel",U,O).on("DOMMouseScroll",U,O).on("touchstart",U,l).on("touchmove",U,T).on("touchend",U,M);$(window).on("resize",U,y).on("redraw",U,y);$.data(this,"_sg_config","set");return this})}})(jQuery,window,document);